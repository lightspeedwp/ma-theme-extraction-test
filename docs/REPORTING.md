# Reporting System & Standards

This document defines the centralized reporting system for the block theme scaffold project. All reports generated by builds, tests, analysis tools, and AI agents are organized, timestamped, and archived in the `reports/` directory.

## Table of Contents

- [Quick Start](#quick-start)
- [Directory Structure](#directory-structure)
- [Report Categories](#report-categories)
- [Naming Conventions](#naming-conventions)
- [Integration with Logs](#integration-with-logs)
- [Retention & Archival](#retention--archival)
- [Common Patterns](#common-patterns)
- [Troubleshooting](#troubleshooting)
- [Related Documentation](#related-documentation)

## Quick Start

### For Developers

Save all reports to `reports/` with ISO date prefix:

```bash
# ✅ Correct
reports/coverage/js/2025-12-07-coverage.html
reports/validation/2025-12-07-eslint-report.json
reports/analysis/2025-12-07-lighthouse.json

# ❌ Never do this
./my-report.json
./coverage.html
coverage-report.json
```

### For AI Agents

When generating reports, **always**:

1. Use `reports/` directory
2. Include ISO date in filename (`YYYY-MM-DD`)
3. Organize into category subdirectory
4. Reference related log file
5. Clean up temporary files after processing

See [.github/instructions/reporting.instructions.md](.github/instructions/reporting.instructions.md) for detailed agent guidelines.

## Directory Structure

```
reports/
├── .gitkeep
├── README.md                          # System overview (this file)
├── coverage/                          # Code coverage metrics
│   ├── js/                           # JavaScript coverage
│   │   ├── 2025-12-07-coverage.html
│   │   ├── 2025-12-07-coverage.json
│   │   └── 2025-12-07-lcov-report/
│   └── php/                          # PHP coverage
│       ├── 2025-12-07-coverage.html
│       └── 2025-12-07-coverage.json
├── analysis/                          # Code analysis, bundle analysis, security, accessibility
│   ├── 2025-12-07-bundle-analysis.html
│   ├── 2025-12-07-lighthouse.json
│   ├── 2025-12-07-accessibility.json
│   └── 2025-12-07-security-audit.json
├── validation/                        # Linting and code quality validation
│   ├── 2025-12-07-eslint-report.json
│   ├── 2025-12-07-stylelint-report.json
│   ├── 2025-12-07-phpcs-report.json
│   └── 2025-12-07-validation-summary.json
├── performance/                       # Performance metrics and budgets
│   ├── 2025-12-07-lighthouse.json
│   ├── 2025-12-07-bundle-size.json
│   ├── 2025-12-07-core-web-vitals.json
│   └── 2025-12-07-performance-budget.json
├── agents/                            # AI agent execution reports
│   ├── 2025-12-07-theme-generator.json
│   ├── 2025-12-07-build-agent.json
│   ├── 2025-12-07-code-review.json
│   └── 2025-12-07-agent-summary.md
├── comparison/                        # Before/after comparison analysis
│   ├── 2025-12-07-diff-report.json
│   ├── 2025-12-07-size-comparison.json
│   └── 2025-12-07-performance-diff.json
└── archived/                          # Old reports (rotated weekly/monthly)
    └── 2025-11-30-*.json              # Previous date's reports
```

## Report Categories

### Coverage Reports

**Purpose**: Code coverage metrics from test execution

**Directory**: `reports/coverage/{js|php}/`

**Files**:

- `YYYY-MM-DD-coverage.html` - Interactive HTML report
- `YYYY-MM-DD-coverage.json` - JSON coverage data
- `YYYY-MM-DD-lcov-report/` - Detailed line-by-line coverage

**Generated By**: Jest, PHPUnit, Playwright
**When**: After `npm run test:coverage` or PHPUnit test runs
**Related Logs**: `logs/test/YYYY-MM-DD-*.log`

**Example Contents**:

```json
{
  "date": "2025-12-07T10:30:45.123Z",
  "tool": "jest",
  "type": "coverage",
  "metrics": {
    "statements": 92.5,
    "branches": 88.3,
    "functions": 90.1,
    "lines": 93.2
  },
  "logFile": "logs/test/2025-12-07-jest.log"
}
```

### Analysis Reports

**Purpose**: Code analysis, bundle analysis, accessibility, and security audits

**Directory**: `reports/analysis/`

**Files**:

- `YYYY-MM-DD-bundle-analysis.html` - Webpack bundle visualization
- `YYYY-MM-DD-lighthouse.json` - Lighthouse audit results
- `YYYY-MM-DD-accessibility.json` - Accessibility audit (axe-core)
- `YYYY-MM-DD-security-audit.json` - npm audit or dependency check

**Generated By**: Webpack Bundle Analyzer, Lighthouse CI, axe-core, npm audit
**When**: During build, accessibility testing, or security scanning
**Related Logs**: `logs/build/`, `logs/test/`

### Validation Reports

**Purpose**: Linting and code quality check results

**Directory**: `reports/validation/`

**Files**:

- `YYYY-MM-DD-eslint-report.json` - ESLint validation
- `YYYY-MM-DD-stylelint-report.json` - CSS/SCSS linting
- `YYYY-MM-DD-phpcs-report.json` - PHP CodeSniffer results
- `YYYY-MM-DD-validation-summary.json` - Aggregated results

**Generated By**: ESLint, Stylelint, PHPCS, package.json-lint
**When**: After `npm run lint` or linting processes
**Related Logs**: `logs/lint/YYYY-MM-DD-*.log`

**Example Contents**:

```json
{
  "date": "2025-12-07T10:30:45.123Z",
  "tool": "eslint",
  "type": "validation",
  "errorCount": 0,
  "warningCount": 3,
  "results": [...],
  "logFile": "logs/lint/2025-12-07-eslint.log"
}
```

### Performance Reports

**Purpose**: Performance metrics, bundle size, and Core Web Vitals

**Directory**: `reports/performance/`

**Files**:

- `YYYY-MM-DD-lighthouse.json` - Lighthouse metrics
- `YYYY-MM-DD-bundle-size.json` - Bundle size metrics
- `YYYY-MM-DD-core-web-vitals.json` - CWV data
- `YYYY-MM-DD-performance-budget.json` - Budget status

**Generated By**: Lighthouse CI, size-limit, Webpack bundle analyzer
**When**: During performance checks or CI/CD runs
**Related Logs**: `logs/build/`

### Agent Reports

**Purpose**: AI agent execution summaries and results

**Directory**: `reports/agents/`

**Files**:

- `YYYY-MM-DD-{agent-name}.json` - Structured agent results
- `YYYY-MM-DD-{agent-name}-summary.md` - Human-readable summary

**Generated By**: AI agents (theme generator, build agent, code review, etc.)
**When**: After agent execution completes
**Related Logs**: `logs/agents/YYYY-MM-DD-{agent-name}.log`

**Example Contents**:

```json
{
  "agent": "theme-generator",
  "timestamp": "2025-12-07T10:30:45.123Z",
  "status": "success",
  "summary": "Generated 5 new block patterns",
  "metrics": {
    "filesCreated": 5,
    "duration": "12.5s",
    "errors": 0,
    "warnings": 1
  },
  "artifacts": [
    "patterns/new-pattern-1.php",
    "patterns/new-pattern-2.php"
  ],
  "logFile": "logs/agents/2025-12-07-theme-generator.log"
}
```

### Comparison Reports

**Purpose**: Before/after comparisons for performance, bundle size, or metrics

**Directory**: `reports/comparison/`

**Files**:

- `YYYY-MM-DD-diff-report.json` - Code change analysis
- `YYYY-MM-DD-size-comparison.json` - Bundle size before/after
- `YYYY-MM-DD-performance-diff.json` - Performance metrics comparison

**Generated By**: CI/CD pipelines, performance analysis tools
**When**: During multi-run analysis or PR validation
**Related Logs**: `logs/build/`, `logs/test/`

## Naming Conventions

All report files follow this pattern:

### Format

**`YYYY-MM-DD-description.{ext}`**

### Rules

| Rule | Example | Details |
|------|---------|---------|
| Date format | `2025-12-07` | ISO 8601 format (YYYY-MM-DD) |
| Date position | Start of filename | Always prefix, not suffix |
| Separator | Hyphen `-` | Not underscores or spaces |
| Description | kebab-case | Descriptive, no underscores |
| Extension | `.html`, `.json`, `.md` | Appropriate to file type |

### Valid Examples

```
✅ 2025-12-07-coverage.json
✅ 2025-12-07-eslint-report.json
✅ 2025-12-07-bundle-analysis.html
✅ 2025-12-07-lighthouse.json
✅ 2025-12-07-agent-summary.md
✅ 2025-12-07-performance-budget.json
```

### Invalid Examples

```
❌ coverage.json                    (no date)
❌ coverage-2025-12-07.json        (date at end)
❌ eslint_report.json              (underscore instead of hyphen)
❌ report.json                      (no date, no description)
❌ 20251207-report.json            (wrong date format)
❌ report-eslint-2025-12-07.json   (wrong order)
```

## Integration with Logs

Reports and logs work together to provide full context:

### Report Structure

Every report should include:

```json
{
  "date": "2025-12-07T10:30:45.123Z",
  "tool": "jest",
  "type": "coverage",
  "logFile": "logs/test/2025-12-07-jest.log",
  "metrics": { /* ... */ }
}
```

### Log References

Logs should reference their generated reports:

```
[2025-12-07T10:30:45.123Z] INFO: Generating coverage report: reports/coverage/js/2025-12-07-coverage.json
[2025-12-07T10:30:46.234Z] INFO: Report saved with 92.5% statement coverage
```

### Finding Related Files

For any report:

1. **Find related log**: Look in `logs/{category}/YYYY-MM-DD-{tool}.log`
2. **Find related data**: Check `reports/{category}/YYYY-MM-DD-*.json`
3. **Find related comparison**: Check `reports/comparison/YYYY-MM-DD-*-diff.json`

## Retention & Archival

### Automatic Cleanup (Recommended)

Implement automatic archival of older reports:

```bash
# Archive reports older than 30 days
find reports/ -type f -mtime +30 -not -path "reports/archived/*" -exec mv {} reports/archived/ \;

# Delete archived reports older than 90 days
find reports/archived/ -type f -mtime +90 -delete
```

### Manual Archival

```bash
# Move specific date to archive
mkdir -p reports/archived
mv reports/*/2025-11-30*.* reports/archived/
```

### Schedule in CI/CD

Add to GitHub Actions or similar:

```yaml
- name: Archive old reports
  run: |
    find reports/ -type f -mtime +30 \
      -not -path "reports/archived/*" \
      -exec mv {} reports/archived/ \;
    find reports/archived/ -type f -mtime +90 -delete
```

## Common Patterns

### Pattern 1: Save Coverage Report

```javascript
const fs = require('fs');
const path = require('path');

function saveCoverageReport(coverageData) {
  const date = new Date().toISOString().split('T')[0];
  const reportDir = 'reports/coverage/js';

  // Ensure directory exists
  fs.mkdirSync(reportDir, { recursive: true });

  // Create structured report
  const report = {
    date: new Date().toISOString(),
    tool: 'jest',
    type: 'coverage',
    metrics: coverageData.coverageSummary,
    logFile: `logs/test/${date}-jest.log`
  };

  // Save report
  const filename = `${date}-coverage.json`;
  fs.writeFileSync(
    path.join(reportDir, filename),
    JSON.stringify(report, null, 2)
  );

  console.log(`✅ Saved: reports/coverage/js/${filename}`);
}
```

### Pattern 2: Save Validation Report

```javascript
const fs = require('fs');
const path = require('path');

async function saveValidationReport(tool, results) {
  const date = new Date().toISOString().split('T')[0];
  const reportDir = 'reports/validation';

  // Ensure directory exists
  fs.mkdirSync(reportDir, { recursive: true });

  // Create structured report
  const report = {
    date: new Date().toISOString(),
    tool: tool,
    type: 'validation',
    errorCount: results.errors || 0,
    warningCount: results.warnings || 0,
    results: results,
    logFile: `logs/lint/${date}-${tool}.log`
  };

  // Save report
  const filename = `${date}-${tool}-report.json`;
  fs.writeFileSync(
    path.join(reportDir, filename),
    JSON.stringify(report, null, 2)
  );

  console.log(`✅ Saved: reports/validation/${filename}`);
}
```

### Pattern 3: Save Agent Report

```javascript
const fs = require('fs');
const path = require('path');

function saveAgentReport(agentName, status, metrics, artifacts) {
  const date = new Date().toISOString().split('T')[0];
  const reportDir = 'reports/agents';

  // Ensure directory exists
  fs.mkdirSync(reportDir, { recursive: true });

  // Create structured report
  const report = {
    agent: agentName,
    timestamp: new Date().toISOString(),
    status: status,
    metrics: metrics,
    artifacts: artifacts,
    logFile: `logs/agents/${date}-${agentName}.log`
  };

  // Save report
  const filename = `${date}-${agentName}.json`;
  fs.writeFileSync(
    path.join(reportDir, filename),
    JSON.stringify(report, null, 2)
  );

  console.log(`✅ Saved: reports/agents/${filename}`);
  return path.join(reportDir, filename);
}
```

## Troubleshooting

### Problem: Reports appear in root directory

**Cause**: Agent or script not using `reports/` path

**Solution**:

1. Check [.github/instructions/reporting.instructions.md](.github/instructions/reporting.instructions.md)
2. Verify all file writes use `reports/{category}/YYYY-MM-DD-*.ext`
3. Add validation to prevent root-level files

```javascript
// Add validation before saving
function validateReportPath(filePath) {
  if (!filePath.startsWith('reports/')) {
    throw new Error(`❌ Invalid report path: ${filePath}. Must be in reports/ directory`);
  }
  return true;
}
```

### Problem: Reports missing dates

**Cause**: Date not added to filename

**Solution**:

```javascript
// Always generate date this way
const date = new Date().toISOString().split('T')[0]; // 2025-12-07
const filename = `${date}-description.json`;
```

### Problem: Reports scattered across subdirectories

**Cause**: Not using standard category structure

**Solution**: Use correct paths:

```
reports/coverage/     - Coverage metrics
reports/analysis/     - Code analysis
reports/validation/   - Linting results
reports/performance/  - Performance metrics
reports/agents/       - Agent reports
reports/comparison/   - Comparisons
```

### Problem: Can't find report related to log

**Cause**: Different dates or missing cross-reference

**Solution**: Always include `logFile` in report:

```json
{
  "logFile": "logs/test/2025-12-07-jest.log",
  "date": "2025-12-07T10:30:45.123Z"
}
```

## Related Documentation

| Document | Purpose | Links |
|----------|---------|-------|
| [.github/instructions/reporting.instructions.md](.github/instructions/reporting.instructions.md) | AI Agent guidelines for report generation | Detailed rules, patterns, code samples |
| [LOGGING.md](LOGGING.md) | Log standards and formats | Log directory structure, log levels, formats |
| [BUILD_PROCESS.md](BUILD_PROCESS.md) | Build system documentation | Build-generated reports and artifacts |
| [LINTING.md](LINTING.md) | Linting standards | Linting validation reports |
| [TESTING.md](TESTING.md) | Testing standards | Coverage and test reports |
| [PERFORMANCE.md](PERFORMANCE.md) | Performance optimization | Performance metrics and budgets |
| [VALIDATION.md](VALIDATION.md) | Validation commands | Quick reference for validation tools |

## Summary

✅ **Central location**: All reports in `reports/` directory
✅ **Organized by type**: Category subdirectories (coverage, analysis, validation, performance, agents, comparison)
✅ **Timestamped**: ISO date prefix (YYYY-MM-DD) for versioning and archival
✅ **Cross-referenced**: Reports link to related logs
✅ **Discoverable**: Consistent naming and structure
✅ **Archivable**: Automatic rotation and cleanup
✅ **Clean source**: Reports excluded from distribution via .gitignore/.distignore
