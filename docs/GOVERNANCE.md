# Project Governance & Policies

## Overview

This document defines the governance structure, policies, and decision-making processes for the block theme scaffold project. All contributors and AI agents must follow these guidelines.

## Core Governance Principles

1. **Code Quality First**: All code must pass linting and testing
2. **Documentation Required**: Changes require updated documentation
3. **Accessibility Non-Negotiable**: WCAG 2.1 AA compliance required
4. **Security Conscious**: Follow OWASP top 10 and WordPress security standards
5. **Clear Communication**: All decisions documented with rationale

## Repository Structure Governance

All code must follow the structure defined in [ARCHITECTURE.md](./ARCHITECTURE.md) and [FOLDER_STRUCTURE.md](./FOLDER_STRUCTURE.md).

### Folder Governance

| Folder | Owner | Guidelines |
|--------|-------|-----------|
| `src/` | Developers | Source code only - no build artifacts |
| `build/` | Build system | Generated only - commit artifacts during dev |
| `inc/` | Core team | PHP backend code - must pass PHPCS |
| `tests/` | QA/Developers | Test files - 80%+ coverage required |
| `docs/` | Documentation | Markdown files - updated with PRs |
| `logs/` | System | Auto-generated - gitignored, never committed |
| `tmp/` | System | Temporary work files - auto-cleaned |
| `reports/` | CI/CD | Generated reports - gitignored |

### Folder Update Rules

**When adding new folders:**

1. Update [ARCHITECTURE.md](./ARCHITECTURE.md) with folder description
2. Update [FOLDER_STRUCTURE.md](./FOLDER_STRUCTURE.md) with naming conventions
3. Update `.distignore` if needed (distribution-relevant)
4. Update `.gitignore` if needed (temporary/generated)
5. Create `.gitkeep` in new directories to maintain structure
6. Document in the folder's own README.md

**When modifying folder organization:**

1. Get approval from core team
2. Migrate existing content following conventions
3. Update all documentation
4. Create migration guide for contributors
5. Add to CHANGELOG.md

## Logging Governance

All processes must log output to `logs/` following standards in [LOGGING.md](./LOGGING.md).

### Logging Requirements

- **Format**: ISO 8601 timestamp, log level, process name, message
- **Location**: `logs/{category}/{YYYY-MM-DD}-{process}.log`
- **Rotation**: Archive/delete logs older than 30 days
- **Exclusion**: Never commit logs to git
- **Distribution**: Exclude from `.distignore`

### Log Categories

| Category | Processes | Owner |
|----------|-----------|-------|
| `logs/lint/` | ESLint, Stylelint, PHPCS | Linting system |
| `logs/test/` | Jest, PHPUnit, Playwright | Testing system |
| `logs/build/` | Webpack, Babel, Sass | Build system |
| `logs/agents/` | AI agent operations | Agent system |

### Log Review Process

1. Logs are generated by automated processes
2. Failed builds/tests generate error logs
3. Developers review logs to understand failures
4. Logs are archived weekly
5. Long-term logs analyzed for trends

## Reporting Governance

Generated reports go to `reports/` and are excluded from distribution and version control.

### Report Organization

```
reports/
├── coverage/             # Code coverage metrics
├── performance/          # Lighthouse, bundle analysis
├── test-results/         # Test execution results
└── agents/               # AI agent analysis reports
```

### Report Types & Frequency

| Report Type | Frequency | Owner | Purpose |
|-------------|-----------|-------|---------|
| Coverage | Per test run | Jest/PHPUnit | Code coverage metrics |
| Performance | Per build | Webpack/Lighthouse | Performance monitoring |
| Test Results | Per test run | Jest/PHPUnit | Test status and results |
| Bundle Analysis | Per build | Webpack analyzer | Bundle size tracking |
| Agent Metrics | Per agent run | Agents | Agent performance metrics |

### Report Archival

1. Keep recent reports (30 days)
2. Archive older reports with compression
3. Generate quarterly trend reports
4. Clean up archived reports after 1 year

## Code Quality Governance

### Quality Standards

**JavaScript:**

- ESLint passing (WordPress config)
- Prettier formatting
- 80%+ test coverage

**CSS/SCSS:**

- Stylelint passing
- No CSS specificity issues
- Mobile-first responsive design

**PHP:**

- PHPCS passing (WordPress standards)
- PHPStan strict level
- 80%+ test coverage

### Pre-commit Checks

The Husky pre-commit hook runs:

1. JavaScript linting (or dry-run for scaffold)
2. CSS linting (or dry-run for scaffold)
3. PHP linting
4. Security audit (generated themes only)

**Bypass only with** `git commit --no-verify` (not recommended)

### Code Review Process

**For Pull Requests:**

1. Automatic linting checks must pass
2. Tests must pass
3. Code coverage must not decrease
4. Documentation must be updated
5. Security review required for sensitive code
6. At least 2 approvals from core team

**For Direct Commits:**

1. Same checks as PR
2. Direct commit only for hotfixes
3. Requires IMMEDIATE PR for tracking

## Testing Governance

### Test Requirements

| Type | Coverage | Required | Owner |
|------|----------|----------|-------|
| Unit (JS) | 80%+ | Yes | Developers |
| Unit (PHP) | 80%+ | Yes | Developers |
| Integration | 60%+ | Yes | QA |
| E2E | 40%+ | Yes | QA |

### Test Execution

1. Run before commit: `npm run test`
2. Run before push: `npm run test && npm run lint`
3. Run on PR: Automated CI
4. Run on release: Full suite + performance tests

### Skipping Tests

**Only skip tests with**:

1. Documented reason in code comment
2. Ticket reference (e.g., `// TODO: #123`)
3. Temporary marker (`.skip` or `.only`)
4. **Must be resolved before merge**

```javascript
// ✓ Good - Temporary skip with ticket
it.skip('should handle missing data', () => {
  // TODO: Fix when data service updated (#456)
  expect(true).toBe(true);
});

// ✗ Bad - Skip without reason
it.skip('should handle edge case', () => {
  expect(true).toBe(true);
});
```

## Documentation Governance

### Documentation Requirements

1. **Every feature needs documentation**
2. **Every breaking change requires migration guide**
3. **Every API needs reference documentation**
4. **All docs in `docs/` folder with markdown**
5. **Links to related docs in each file**

### Documentation Update Rules

**When merging a PR:**

1. Feature docs created in `docs/`
2. API reference updated
3. README updated if relevant
4. CHANGELOG.md updated
5. Version number updated if warranted

**Documentation templates:**

- [Features](./README.md) - Standard structure
- [API](./API_REFERENCE.md) - Reference format
- [Architecture](./ARCHITECTURE.md) - Structural overview

## Security Governance

### Security Standards

1. **OWASP Top 10**: All code must address top vulnerabilities
2. **Nonce Verification**: Required for all AJAX/form handlers
3. **Data Validation**: All user input must be validated
4. **Sanitization**: All output must be escaped
5. **Authentication**: WordPress auth for admin functions

### Security Review Checklist

- [ ] Input validation implemented
- [ ] Output escaping implemented
- [ ] Nonce verification for forms
- [ ] Capability checks for admin functions
- [ ] No hardcoded secrets
- [ ] Dependencies have no high CVEs
- [ ] Security headers configured

### Security Audit

1. Weekly: NPM audit for dependencies
2. Monthly: Manual code review for vulnerabilities
3. Quarterly: Third-party security audit
4. On-demand: Emergency security review

## Accessibility Governance

### Accessibility Standards

- WCAG 2.1 AA compliance (minimum)
- ARIA labels where appropriate
- Keyboard navigation for all interactive elements
- Color contrast ratio 4.5:1+ for text
- Focus indicators visible

### Accessibility Checklist

- [ ] Semantic HTML used
- [ ] ARIA labels appropriate
- [ ] Keyboard navigation works
- [ ] Color contrast meets standards
- [ ] Alt text for images
- [ ] Form labels associated with inputs
- [ ] Focus visible
- [ ] No auto-playing media

## Performance Governance

### Performance Targets

- **Lighthouse Score**: 90+ (mobile and desktop)
- **Bundle Size**: < 50KB gzipped (JS)
- **CSS Size**: < 20KB gzipped
- **First Contentful Paint**: < 1.5s
- **Core Web Vitals**: All green

### Performance Monitoring

1. Run Lighthouse on every build: `npm run lighthouse`
2. Track bundle size: `npm run analyze-bundle`
3. Monitor performance trends: `npm run performance`
4. Alert on regressions: Automated in CI

## Versioning Governance

### Semantic Versioning

Format: `MAJOR.MINOR.PATCH`

- **MAJOR**: Breaking changes
- **MINOR**: New features (backward compatible)
- **PATCH**: Bug fixes

### Version Update Process

1. Update `VERSION` file
2. Update `package.json` version
3. Update `composer.json` version
4. Update `style.css` header comment
5. Update CHANGELOG.md
6. Tag release in git

### Release Process

1. Create release branch: `release/x.y.z`
2. Update version files
3. Update CHANGELOG.md
4. Merge to `main` and `develop`
5. Tag: `git tag vx.y.z`
6. Create GitHub release
7. Deploy to WordPress.org (if applicable)

## AI Agent Governance

### Agent Rules

1. **Must follow linting standards**: No style violations
2. **Must log operations**: Output to `logs/agents/`
3. **Must generate reports**: Analysis to `reports/agents/`
4. **Must document changes**: Update relevant docs
5. **Must test before commit**: Run `npm run test`

### Agent Logging

```javascript
const logger = new FileLogger('agent-name');
logger.info('[AGENT] Starting task...');
logger.debug('[STEP 1] Reading files...');
logger.error('[ERROR] Failed to process file');
logger.info('[RESULT] Task completed');
```

### Agent Approval Process

1. Agent code reviewed by human before execution
2. Agent output logs reviewed
3. Generated reports analyzed
4. Human approval required for file changes
5. Agent commits tracked in CHANGELOG.md

## Decision Making

### Decision Process

**For major changes:**

1. Create GitHub issue with proposal
2. Get feedback from core team
3. Document decision in issue
4. Update relevant governance documents
5. Link to issue in implementation

**For minor changes:**

1. Document in code comments
2. Add to CHANGELOG.md
3. Update relevant docs

### Dispute Resolution

1. **Technical disagreement**: Code review discussion
2. **Standards question**: Reference CONTRIBUTING.md
3. **Architecture decision**: Core team vote
4. **Escalation**: Project maintainer final decision

## Compliance Checklist

Before shipping code:

- [ ] Linting passes (`npm run lint`)
- [ ] Tests pass (`npm run test`)
- [ ] Coverage maintained (80%+)
- [ ] Documentation updated
- [ ] Security checklist passed
- [ ] Accessibility checklist passed
- [ ] Performance targets met
- [ ] CHANGELOG.md updated
- [ ] Version updated (if warranted)
- [ ] Code review approved

## Enforcement

### Automated Enforcement

- ESLint: Pre-commit hook
- Prettier: Pre-commit hook
- Tests: CI/CD pipeline
- Security: `npm audit` check
- Coverage: CI/CD report

### Manual Enforcement

- Code review approval required
- Documentation review
- Accessibility review
- Performance review

### Consequences of Non-Compliance

1. **First violation**: Warning + request to fix
2. **Second violation**: PR blocked until fixed
3. **Repeated violations**: Contributor access restricted
4. **Severe violations**: Removal from project

## Related Documentation

- [ARCHITECTURE.md](./ARCHITECTURE.md) - Repository structure
- [FOLDER_STRUCTURE.md](./FOLDER_STRUCTURE.md) - Naming conventions
- [LOGGING.md](./LOGGING.md) - Logging standards
- [CONTRIBUTING.md](../CONTRIBUTING.md) - Contributing guidelines

## Version History

| Date | Change |
|------|--------|
| 2025-12-07 | Initial governance documentation |
| 2025-12-07 | Added logs/, tmp/, reports/ governance |
| 2025-12-07 | Integrated with AI agent rules |
