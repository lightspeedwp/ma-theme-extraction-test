---
name: "Internationalization (i18n)"
description: "Internationalization and localization best practices for WordPress block theme development"
applyTo: "**/*.{php,js,jsx,ts,tsx}"
---

# Internationalization (i18n) & Localization (l10n) Standards

## Purpose

This instruction file provides comprehensive standards for implementing internationalization (i18n) and localization (l10n) in WordPress block themes. All user-facing strings must be translatable to support global audiences.

## Core Principles

1. **Everything Translatable**: All user-facing strings must use translation functions
2. **Consistent Text Domain**: Use `ma-theme` as the text domain throughout
3. **Context for Translators**: Provide translator comments for ambiguous strings
4. **No String Concatenation**: Use placeholders instead of concatenating translatable strings
5. **Automated Workflow**: Build process generates translation files automatically

## Text Domain

**Theme Text Domain**: `ma-theme`

The text domain MUST match:
- Theme slug in `style.css`
- `Text Domain:` header in `style.css`
- All translation function calls
- POT file generation in build scripts

## PHP Translation Functions

### 1. Basic Translation: `__()`

For returning translated strings:

```php
// ✅ Correct
$title = __('Welcome to our theme', 'ma-theme');
echo '<h1>' . esc_html($title) . '</h1>';

// ❌ Incorrect - missing text domain
$title = __('Welcome to our theme');

// ❌ Incorrect - wrong text domain
$title = __('Welcome to our theme', 'different-domain');
```

### 2. Echo Translation: `_e()`

For directly outputting translated strings:

```php
// ✅ Correct
<h1><?php _e('Site Title', 'ma-theme'); ?></h1>

// ❌ Incorrect
<h1><?php echo __('Site Title', 'ma-theme'); ?></h1> // Use _e() instead
```

### 3. Escaped Translation: `esc_html__()` and `esc_html_e()`

Always use escaped translation functions in templates:

```php
// ✅ Correct - returning escaped
$text = esc_html__('Hello World', 'ma-theme');

// ✅ Correct - echoing escaped
<p><?php esc_html_e('Welcome Message', 'ma-theme'); ?></p>

// ❌ Incorrect - double escaping
echo esc_html(esc_html__('Text', 'ma-theme')); // Don't do this!
```

### 4. Attribute Translation: `esc_attr__()`  and `esc_attr_e()`

For HTML attributes:

```php
// ✅ Correct
<input
    type="text"
    placeholder="<?php echo esc_attr__('Enter your name', 'ma-theme'); ?>"
/>

// ✅ Correct - direct output
<input
    type="text"
    aria-label="<?php esc_attr_e('Search', 'ma-theme'); ?>"
/>
```

### 5. Plural Forms: `_n()`

For strings with singular/plural forms:

```php
// ✅ Correct
$count = 5;
$message = sprintf(
    _n(
        '%d comment',
        '%d comments',
        $count,
        'ma-theme'
    ),
    number_format_i18n($count)
);

// ❌ Incorrect - concatenation
$message = $count . ' ' . ($count === 1 ? 'comment' : 'comments');
```

### 6. Context-Specific: `_x()` and `_ex()`

For strings that need context:

```php
// ✅ Correct - "Post" as in blog post
$label = _x('Post', 'noun: blog post', 'ma-theme');

// ✅ Correct - "Post" as in verb
$button = _x('Post', 'verb: publish action', 'ma-theme');

// Context helps translators understand the meaning
<button><?php echo esc_html(_x('Read', 'verb: read article', 'ma-theme')); ?></button>
```

## JavaScript Translation Functions

### WordPress i18n Package

Use `@wordpress/i18n` package for JavaScript translations:

```javascript
import { __, _x, _n, sprintf } from '@wordpress/i18n';

// ✅ Correct - basic translation
const title = __('Block Settings', 'ma-theme');

// ✅ Correct - with context
const label = _x('Media', 'block category', 'ma-theme');

// ✅ Correct - plural
const count = 5;
const message = sprintf(
    _n('%d item', '%d items', count, 'ma-theme'),
    count
);
```

### React Components

```jsx
import { __ } from '@wordpress/i18n';

function MyComponent() {
    return (
        <div>
            <h2>{__('Component Title', 'ma-theme')}</h2>
            <p>{__('Description text here', 'ma-theme')}</p>
        </div>
    );
}
```

### Block Metadata (block.json)

Strings in `block.json` are automatically extracted:

```json
{
    "title": "My Block",
    "description": "A custom block for the theme",
    "keywords": ["custom", "block"],
    "textdomain": "ma-theme"
}
```

## Translator Comments

### When to Use

Add translator comments for:
- Ambiguous terms
- Brand names or technical terms
- Strings with placeholders
- Context-dependent strings

### PHP Translator Comments

```php
// ✅ Correct - translator comment
/* translators: %s: The name of the theme */
$message = sprintf(
    __('Powered by %s', 'ma-theme'),
    'Medical Academic Theme'
);

// ✅ Correct - multiple placeholders
/* translators: 1: Post title, 2: Author name */
$text = sprintf(
    __('"%1$s" by %2$s', 'ma-theme'),
    get_the_title(),
    get_the_author()
);
```

### JavaScript Translator Comments

```javascript
// ✅ Correct
/* translators: %s: Number of items */
const message = sprintf(
    __('You have %s items in your cart', 'ma-theme'),
    count
);
```

## String Placeholders

### PHP sprintf() Patterns

```php
// ✅ Correct - numbered placeholders
/* translators: 1: date, 2: author */
$meta = sprintf(
    __('Published on %1$s by %2$s', 'ma-theme'),
    get_the_date(),
    get_the_author()
);

// ✅ Correct - for counts
$message = sprintf(
    _n(
        'One comment',
        '%s comments',
        $count,
        'ma-theme'
    ),
    number_format_i18n($count)
);

// ❌ Incorrect - concatenation
$text = __('Published on', 'ma-theme') . ' ' . get_the_date();
```

### JavaScript sprintf() Patterns

```javascript
import { __, sprintf } from '@wordpress/i18n';

// ✅ Correct
const message = sprintf(
    /* translators: %s: user name */
    __('Hello, %s!', 'ma-theme'),
    userName
);

// ❌ Incorrect - template literals
const message = `Hello, ${userName}!`; // Not translatable!
```

## Build Process

### npm Scripts

The theme includes these i18n build scripts:

```bash
# Generate POT file from all PHP and JS files
npm run makepot

# Generate POT from PHP files only
npm run makepot:php

# Generate JSON files for JavaScript translations
npm run makejson

# Run full i18n build (POT + JSON)
npm run i18n
```

### POT File Generation

The `makepot` script uses WP-CLI:

```bash
wp i18n make-pot . languages/ma-theme.pot \
    --slug=ma-theme \
    --domain=ma-theme \
    --exclude=node_modules,vendor,build,tests
```

**Generates**: `languages/ma-theme.pot`

This file contains all extractable strings and serves as the template for translators.

### JSON File Generation

The `makejson` script converts PO files to JSON for JavaScript:

```bash
wp i18n make-json languages --no-purge
```

**Generates**: `languages/ma-theme-{locale}-{hash}.json`

These JSON files are automatically loaded by WordPress when needed for JavaScript translations.

## Translation File Structure

```
languages/
├── ma-theme.pot              # Template file (generated)
├── ma-theme-es_ES.po         # Spanish translation (manual)
├── ma-theme-es_ES.mo         # Spanish compiled (generated)
├── ma-theme-es_ES-{hash}.json # Spanish JS (generated)
├── ma-theme-fr_FR.po         # French translation (manual)
├── ma-theme-fr_FR.mo         # French compiled (generated)
└── ma-theme-fr_FR-{hash}.json # French JS (generated)
```

### File Types

| Extension | Purpose | Generated By |
|-----------|---------|--------------|
| `.pot` | Translation template | `npm run makepot` |
| `.po` | Human-readable translation | Translators (Poedit, etc.) |
| `.mo` | Machine-readable compiled | Poedit, Loco Translate |
| `.json` | JavaScript translations | `npm run makejson` |

## Loading Text Domain

### In functions.php

```php
/**
 * Load theme textdomain for translations
 */
function {{prefix}}_load_textdomain() {
    load_theme_textdomain(
        'ma-theme',
        get_template_directory() . '/languages'
    );
}
add_action('after_setup_theme', '{{prefix}}_load_textdomain');
```

### For JavaScript

WordPress automatically loads JSON translation files when using `@wordpress/i18n` package. No additional configuration needed.

## Common Patterns

### Pattern 1: Template Meta Information

```php
<div class="entry-meta">
    <?php
    printf(
        /* translators: 1: Post date, 2: Post author */
        esc_html__('Posted on %1$s by %2$s', 'ma-theme'),
        '<time datetime="' . esc_attr(get_the_date('c')) . '">' . esc_html(get_the_date()) . '</time>',
        '<span class="author">' . esc_html(get_the_author()) . '</span>'
    );
    ?>
</div>
```

### Pattern 2: Conditional Messages

```php
// ✅ Correct - each string fully translatable
if ($has_posts) {
    echo esc_html__('Results found', 'ma-theme');
} else {
    echo esc_html__('No results found', 'ma-theme');
}

// ❌ Incorrect - combining strings
echo esc_html__($has_posts ? 'Results' : 'No results', 'ma-theme') . ' ' . __('found', 'ma-theme');
```

### Pattern 3: Navigation Labels

```php
// ✅ Correct - ARIA labels
<nav
    class="primary-navigation"
    aria-label="<?php esc_attr_e('Primary Navigation', 'ma-theme'); ?>"
>
    <!-- Navigation content -->
</nav>

// ✅ Correct - screen reader text
<span class="screen-reader-text">
    <?php esc_html_e('Skip to content', 'ma-theme'); ?>
</span>
```

### Pattern 4: Dynamic Block Attributes

```javascript
import { registerBlockType } from '@wordpress/blocks';
import { __ } from '@wordpress/i18n';

registerBlockType('ma_theme/custom-block', {
    title: __('Custom Block', 'ma-theme'),
    description: __('A custom block for the theme', 'ma-theme'),
    category: 'widgets',
    attributes: {
        content: {
            type: 'string',
            default: __('Default content', 'ma-theme')
        }
    },
    edit: (props) => {
        return (
            <div>
                <p>{__('Edit mode content', 'ma-theme')}</p>
            </div>
        );
    }
});
```

## Testing Translations

### 1. Verify POT File Generation

```bash
npm run makepot
cat languages/ma-theme.pot
```

Check that:
- All user-facing strings are extracted
- Translator comments are included
- Context is preserved
- Plural forms are correct

### 2. Test with a Translation Plugin

Use **Loco Translate** or **Poedit**:

1. Generate POT file: `npm run makepot`
2. Create test translation (e.g., es_ES)
3. Translate a few strings
4. Compile to .mo file
5. Test in WordPress with language set to Spanish

### 3. Check JavaScript Translations

```bash
npm run makejson
ls -la languages/*.json
```

Verify JSON files are generated for each locale.

## Common Mistakes to Avoid

### ❌ Mistake 1: String Concatenation

```php
// ❌ NEVER do this
echo __('Hello', 'ma-theme') . ' ' . $name;

// ✅ Do this instead
printf(
    /* translators: %s: User name */
    esc_html__('Hello %s', 'ma-theme'),
    esc_html($name)
);
```

### ❌ Mistake 2: Translating Variables

```php
// ❌ NEVER do this
$text = 'Some dynamic text';
echo __($text, 'ma-theme'); // Cannot extract variable content!

// ✅ Do this instead - use conditional
if ($condition) {
    echo esc_html__('Option A', 'ma-theme');
} else {
    echo esc_html__('Option B', 'ma-theme');
}
```

### ❌ Mistake 3: HTML in Translatable Strings

```php
// ❌ Avoid HTML in translatable strings
echo __('<strong>Bold text</strong> here', 'ma-theme');

// ✅ Do this instead
printf(
    /* translators: %s: Important text */
    esc_html__('%s here', 'ma-theme'),
    '<strong>' . esc_html__('Bold text', 'ma-theme') . '</strong>'
);
```

### ❌ Mistake 4: Wrong Text Domain

```php
// ❌ Incorrect
__('Text', 'wordpress'); // Wrong domain
__('Text'); // Missing domain

// ✅ Correct
__('Text', 'ma-theme');
```

### ❌ Mistake 5: Not Using Escaped Functions

```php
// ❌ Incorrect - potential XSS
<h1><?php echo __('Title', 'ma-theme'); ?></h1>

// ✅ Correct
<h1><?php echo esc_html__('Title', 'ma-theme'); ?></h1>

// ✅ Even better
<h1><?php esc_html_e('Title', 'ma-theme'); ?></h1>
```

## Workflow Integration

### During Development

1. Write code with proper translation functions
2. Add translator comments where needed
3. Test locally with default language

### Before Release

1. Generate POT file: `npm run makepot`
2. Review POT file for completeness
3. Update version in `style.css` if needed
4. Distribute POT file to translators

### After Translation

1. Receive PO files from translators
2. Place in `languages/` directory
3. Generate JSON files: `npm run makejson`
4. Test with each language
5. Commit PO and MO files to repository

### Automated Build

The build process should include:

```bash
# In CI/CD or pre-release
npm run i18n  # Generates POT and JSON files
```

## Developer Checklist

Before committing code, verify:

- [ ] All user-facing strings use translation functions
- [ ] Correct text domain used: `ma-theme`
- [ ] Translator comments added for ambiguous strings
- [ ] Placeholders used instead of concatenation
- [ ] Proper escaping functions used (`esc_html__`, etc.)
- [ ] POT file generation works: `npm run makepot`
- [ ] No HTML in translatable strings
- [ ] Plural forms use `_n()` function
- [ ] Context provided with `_x()` where needed
- [ ] JavaScript strings use `@wordpress/i18n`

## PHPCS and ESLint Rules

### PHP Sniffs

WordPress Coding Standards includes i18n sniffs:

- `WordPress.WP.I18n.MissingTranslatorsComment` - Requires translator comments
- `WordPress.WP.I18n.NonSingularStringLiteralDomain` - Text domain must be string literal
- `WordPress.WP.I18n.NonSingularStringLiteralText` - Translatable text must be string literal
- `WordPress.WP.I18n.NoHtmlWrappedStrings` - No HTML in translatable strings

### ESLint Rules

The `@wordpress/eslint-plugin` includes i18n rules for JavaScript.

## Related Documentation

- [wpcs-php.instructions.md](wpcs-php.instructions.md) - PHP coding standards
- [javascript.instructions.md](javascript.instructions.md) - JavaScript standards
- [block-theme-development.instructions.md](block-theme-development.instructions.md) - Block theme guidelines

## External Resources

- [WordPress I18n for Developers](https://developer.wordpress.org/apis/internationalization/)
- [WordPress I18n Functions](https://developer.wordpress.org/reference/functions/_/)
- [WP-CLI I18n Commands](https://developer.wordpress.org/cli/commands/i18n/)
- [@wordpress/i18n Package](https://developer.wordpress.org/block-editor/reference-guides/packages/packages-i18n/)
- [GlotPress Translation Platform](https://translate.wordpress.org/)

## Version History

| Date       | Change                                    |
| ---------- | ----------------------------------------- |
| 2025-12-10 | Initial i18n/l10n standards               |
| 2025-12-10 | Added build process documentation         |
| 2025-12-10 | Added JavaScript translation patterns     |
| 2025-12-10 | Added testing and workflow integration    |
